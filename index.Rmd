---
title: "Human Activity Recognition Tool to Classify the Type of Weight Lifting Exercises" 
author: "Moh A"
date: "01/04/2017"
output: 
  html_document: 
    keep_md: yes
---

# Executive Summary



## Background

Using devices such as Jawbone Up, Nike FuelBand, and Fitbit it is now possible to collect a large amount of data about personal activity relatively inexpensively. These type of devices are part of the quantified self movement â€“ a group of enthusiasts who take measurements about themselves regularly to improve their health, to find patterns in their behavior, or because they are tech geeks. One thing that people regularly do is quantify how much of a particular activity they do, but they rarely quantify how well they do it. In this project, **the goal will be to use data from accelerometers on the belt, forearm, arm, and dumbell of 6 participants to predict the manner in which they did the exercise**. They were asked to perform barbell lifts correctly and incorrectly in 5 different ways. The participants were asked to perform one set of 10 repetitions of the Unilateral Dumbbell Biceps Curl in five different fashions: exactly according to the specification (Class A), while the other 4 classes (B, C, D and E) correspond to common mistakes.

Read more: http://groupware.les.inf.puc-rio.br/har#ixzz4d1GCDX2m

# Exploratory Data Analysis

In the dataset given, there is 19622 observations and 160 variable.

The dependent variable, 'Classe', is a categorical variable corresponding to the five different ways of doing the weight lifting exercise: exactly according to the specification (Class A), throwing the elbows to the front (Class B), lifting the dumbbell only halfway (Class C), lowering the dumbbell only halfway (Class D) and throwing the hips to the front (Class E).

The rest of the variable corresponds to measurements from date, time, belt, arm, forearm and dumbbell sensors.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
classe_table <- table(raw_data$classe)
classe_percent <- (100*classe_table)/length(raw_data$classe)
kable(rbind(classe_table, classe_percent))
```


```{r}
name_per_classe <-table(raw_data$classe, raw_data$user_name)

barplot(name_per_classe,
xlab = "Subject",
ylab = "Frequency",
main="Exercise Quality by Subject",
col = as.factor(rownames(name_per_classe)),
beside=TRUE
)

legend("topright" ,legend= rownames(name_per_classe), fill  = as.factor(rownames(name_per_classe)))
```


Read more: http://groupware.les.inf.puc-rio.br/har#ixzz4dkhaGN9v


# Data PreProcessing

## Load Libraries
```{r, echo=TRUE, message=FALSE, warning=FALSE}
library(caret)
```

## Download  and Read the Data

```{r, echo=TRUE, message=FALSE, warning=FALSE}
dataset_url <- "https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv"
dataset_filename <- "./data/pml-training.csv"

if (!file.exists("./data")){
    dir.create("./data")
}
if(!file.exists(dataset_filename)){
    download.file(dataset_url, destfile = dataset_filename, method = "curl")
}

raw_data <- read.table("./data/pml-training.csv", header = TRUE, sep = ",",  na.strings = c(NA, ""))
```

The raw data file has 19622 observations and 160 variable.

## Clean the data

Firstly, looking at the plot below for the amount of the missing data, it can be noticed that it has many variables with mostly missing and meaningless values. Thus, their contribution to the predition of the 'classe' variable is insignificant and we have to omit these variables.

Secondly, it is wise to remove variables that do not contribute to the prediction of the 'classe' variable. Those incluse non-sensory information like: 'X'(raw number), user_name and time and date related variables.  


```{r, message=FALSE, warning=FALSE, include=FALSE}
aggr(raw_data, prop=T, numbers=T)
mojority_NA_columns <- which(sapply(raw_data, function(x) sum(is.na(x)) >(nrow(raw_data)*0.9)))
cleaned_data <- raw_data[, -mojority_NA_columns]
cleaned_data <- cleaned_data[, -(1:6)]
```



```{r, message=FALSE, warning=FALSE, include=FALSE}
library(parallel)
library(doParallel)
library(mlbench)

set.seed(55555)
inTrain <- createDataPartition(y=cleaned_data$classe,
p=0.7, list=FALSE)
training <- cleaned_data[inTrain,]
testing <- cleaned_data[-inTrain,]

cluster <- makeCluster(detectCores() - 1) # convention to leave 1 core for OS
registerDoParallel(cluster)

train_control <- trainControl(method="cv", number=10, allowParallel = TRUE)
model_RF <- train(classe~., data = training, methods = "rf",trControl = train_control)

stopCluster(cluster)
registerDoSEQ()

predict_RF <- predict(model_RF, testing)
confusionMatrix(testing$classe, predict_RF)


```


- how you built your model,
    - Different models tried
    - Comparison and evaluation of the different models.
- how you used cross validation, 
- what you think the expected out of sample error is,
- why you made the choices you did.

Reference

- Ugulino, W.; Cardador, D.; Vega, K.; Velloso, E.; Milidiu, R.; Fuks, H. Wearable Computing: Accelerometers' Data Classification of Body Postures and Movements. Proceedings of 21st Brazilian Symposium on Artificial Intelligence. Advances in Artificial Intelligence - SBIA 2012. In: Lecture Notes in Computer Science. , pp. 52-61. Curitiba, PR: Springer Berlin / Heidelberg, 2012. ISBN 978-3-642-34458-9. DOI: 10.1007/978-3-642-34459-6_6. 
